@model IEnumerable<CouponModel>
@{
    ViewData["Title"] = "Mã Giảm Giá";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .coupon-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .coupon-card {
        display: flex;
        border: 1px dashed #ddd;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        background: white;
    }

    .coupon-left {
        flex: 3;
        padding: 20px;
        position: relative;
        border-right: 2px dashed #ccc;
    }

    .coupon-right {
        flex: 1;
        background: #ee4d2d;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 10px;
        position: relative;
    }

    .discount-value {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .coupon-code {
        font-weight: bold;
        background: #f7f7f7;
        border: 1px dashed #ddd;
        padding: 5px 10px;
        border-radius: 4px;
        margin: 10px 0;
        color: #ee4d2d;
        user-select: all;
    }

    .copy-btn {
        background: #ee4d2d;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.2s;
    }

        .copy-btn:hover {
            background: #ff6a47;
        }

    .expiry-date {
        font-size: 12px;
        color: #999;
        margin-top: 10px;
    }

    .coupon-description {
        font-size: 14px;
        color: #666;
        margin: 10px 0;
    }

    .coupon-usage {
        font-size: 12px;
        color: #999;
        margin-top: 5px;
    }

    .coupon-icon {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 18px;
        color: #ee4d2d;
    }

    .scissors {
        position: absolute;
        top: -10px;
        right: 20px;
        color: #aaa;
        font-size: 16px;
        transform: rotate(90deg);
    }

    .ribbon {
        position: absolute;
        top: 10px;
        left: -30px;
        background: #ee4d2d;
        color: white;
        padding: 2px 30px;
        transform: rotate(-45deg);
        font-size: 12px;
        font-weight: bold;
    }

    .saved-message {
        display: none;
        background: #4caf50;
        color: white;
        padding: 10px;
        text-align: center;
        border-radius: 4px;
        margin-top: 10px;
        margin-bottom: 20px;
    }

</style>

<section id="coupons">
    <div class="container">
        <div class="breadcrumbs">
            <ol class="breadcrumb">
                <li><a href="#">Home</a></li>
                <li class="active">Mã Giảm Giá</li>
            </ol>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <h2 class="title text-center">Mã Giảm Giá Của Bạn</h2>
            </div>
        </div>

        <div class="row" style="margin-top: 30px;">
            <div class="col-sm-12">
                <div class="coupon-grid">
                    @foreach (var coupon in Model)
                    {
                        <div class="coupon-card">
                            <div class="coupon-left">
                                <i class="fa fa-tag coupon-icon"></i>
                                @if ((DateTime.Now - coupon.DateStart).TotalDays < 5)
                                {
                                    <div class="ribbon">MỚI</div>
                                }
                                <h3>
                                    @if (coupon.DiscountType == DiscountType.Percentage)
                                    {
                                        <span>Giảm @coupon.DiscountValue% tổng đơn hàng</span>
                                    }
                                    else
                                    {
                                        <span>Giảm @coupon.DiscountValue.ToString("N0").Replace(",", ".") VNĐ</span>
                                    }
                                </h3>
                                <div class="coupon-description">@coupon.Description</div>
                                <div class="coupon-code">@coupon.Name</div>
                                <button class="copy-btn" onclick="copyCoupon('@coupon.Name')">Sao chép mã</button>
                                <div class="expiry-date">Hết hạn: @coupon.DateExpired.ToString("dd/MM/yyyy")</div>
                                <div class="coupon-usage">Còn lại: @coupon.Quantity lượt sử dụng</div>
                            </div>
                            <div class="coupon-right">
                                @if (coupon.DiscountType == DiscountType.Percentage)
                                {
                                    <div class="discount-value">@coupon.DiscountValue%</div>
                                    <div>OFF</div>
                                }
                                else
                                {
                                    <div class="discount-value">@((int)coupon.DiscountValue / 1000)K</div>
                                    <div>OFF</div>
                                }
                                <i class="fa fa-scissors scissors"></i>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="saved-message" id="savedMessage">
            Đã sao chép mã giảm giá vào clipboard!
        </div>
    </div>
</section>

@section Scripts {
    <script>
        function copyCoupon(code) {
            // Create a temporary input element
            const tempInput = document.createElement("input");
            tempInput.value = code;
            document.body.appendChild(tempInput);

            // Select and copy the text
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            // Show saved message
            const savedMessage = document.getElementById("savedMessage");
            savedMessage.style.display = "block";

            // Hide the message after 2 seconds
            setTimeout(function() {
                savedMessage.style.display = "none";
            }, 2000);

            // Show SweetAlert notification (since you're using SweetAlert in your app)
            Swal.fire({
                title: "Thành công!",
                text: "Đã sao chép mã giảm giá: " + code,
                icon: "success",
                timer: 2000,
                showConfirmButton: false
            });
        }
    </script>
}