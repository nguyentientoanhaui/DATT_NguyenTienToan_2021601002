@model IEnumerable<ProductModel>

<div class="features_items">
    <h2 class="title text-center">Sản Phẩm Bán Chạy</h2>
    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="product-card">
                    <div class="product-image">
                        <a asp-action="Details" asp-controller="Product" asp-route-Id="@item.Id" class="product-link">
                            <img src="~/media/products/@item.Image" alt="@item.Image" class="product-img" />
                        </a>
                        <button class="wishlist-btn" data-product-id="@item.Id">
                            <i class="fa fa-heart"></i>
                        </button>
                        @if (item.Quantity <= 0)
                        {
                            <div class="out-of-stock-badge">Hết hàng</div>
                        }
                        <div class="bestseller-badge" style="position: absolute; top: 10px; left: 10px; background-color: #FF7F50; color: white; padding: 5px 10px; border-radius: 3px; font-weight: bold; z-index: 5;">
                            <i class="fa fa-fire"></i> Bán Chạy
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-title">
                            <a asp-action="Details" asp-controller="Product" asp-route-Id="@item.Id">@item.Name</a>
                        </div>
                        <div class="product-specs">
                            <p>Đã bán: @item.Sold</p>
                            <p>Danh mục: @item.Category.Name</p>
                            <p>Thương hiệu: @item.Brand.Name</p>
                        </div>
                        <div class="price">@item.Price.ToString("N0").Replace(",", ".") VNĐ</div>
                        <div class="product-actions">
                            @if (item.Quantity > 0)
                            {
                                <a href="javascript:void(0)" onclick="addToCart(@item.Id)" class="buy-btn">MUA NGAY</a>
                                <div class="sell-container">
                                    <a href="javascript:void(0)" onclick="getQuote(@item.Id)" class="sell-btn">THU MUA</a>
                                    <div class="quote-text" onclick="getQuote(@item.Id)">Báo Giá</div>
                                </div>
                            }
                            else
                            {
                                <button class="buy-btn disabled" disabled>Hết hàng</button>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script src="~/js/simple-wishlist.js"></script>
<script>
    function addToCart(productId) {
        const formData = new FormData();
        formData.append('productId', productId);
        
        fetch('/Home/AddToCart', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                showNotification('Sản phẩm đã được thêm vào giỏ hàng!', 'success');
                // Update cart count
                if (typeof updateCartCount === 'function') {
                    updateCartCount();
                }
            } else {
                showNotification(data.message || 'Có lỗi xảy ra!', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Có lỗi xảy ra!', 'error');
        });
    }

    function getQuote(productId) {
        window.location.href = '/Sell/Create?productId=' + productId;
    }

    function showNotification(message, type = 'info') {
        if (typeof Swal !== 'undefined') {
            Swal.fire({
                title: type === 'success' ? 'Thành công!' : type === 'error' ? 'Lỗi!' : 'Thông báo',
                text: message,
                icon: type,
                timer: type === 'success' ? 2000 : undefined,
                timerProgressBar: type === 'success'
            });
        } else {
            alert(message);
        }
    }
</script>