@{
    ViewData["Title"] = "Test Data";
}

<div class="container mt-4">
    <h2>Test Database Data</h2>
    
    <div class="mb-3">
        <button class="btn btn-primary" id="createSampleDataBtn">
            <i class="fas fa-plus"></i> T·∫°o D·ªØ Li·ªáu M·∫´u
        </button>
        <button class="btn btn-info" id="refreshDataBtn">
            <i class="fas fa-refresh"></i> L√†m M·ªõi D·ªØ Li·ªáu
        </button>
    </div>
    
    <div id="testResults"></div>
</div>

<script>
$(document).ready(function() {
    // Test Database Info API
    $.post('@Url.Action("GetDatabaseInfo", "Dashboard")', function(response) {
        console.log('Database Info Response:', response);
        
        let html = '<h3>üìä Database Information:</h3>';
        
        if (response.success) {
            const data = response.data;
            html += '<div class="row">';
            html += '<div class="col-md-6">';
            html += '<h4>üì¶ Counts:</h4>';
            html += '<ul>';
            html += '<li>Orders: ' + data.ordersCount + '</li>';
            html += '<li>OrderDetails: ' + data.orderDetailsCount + '</li>';
            html += '<li>Products: ' + data.productsCount + '</li>';
            html += '<li>WishLists: ' + data.wishlistsCount + '</li>';
            html += '<li>Users: ' + data.usersCount + '</li>';
            html += '<li>Brands: ' + data.brandsCount + '</li>';
            html += '<li>Categories: ' + data.categoriesCount + '</li>';
            html += '</ul>';
            html += '</div>';
            
            html += '<div class="col-md-6">';
            html += '<h4>üë• User Info:</h4>';
            html += '<ul>';
            html += '<li>Users with Gender: ' + data.usersWithGender + '</li>';
            html += '<li>Users with Age: ' + data.usersWithAge + '</li>';
            html += '</ul>';
            
            if (data.ordersByStatus && data.ordersByStatus.length > 0) {
                html += '<h4>üìã Orders by Status:</h4>';
                html += '<ul>';
                data.ordersByStatus.forEach(function(item) {
                    html += '<li>Status ' + item.Status + ': ' + item.Count + ' orders</li>';
                });
                html += '</ul>';
            }
            html += '</div>';
            html += '</div>';
            
            if (data.sampleOrders && data.sampleOrders.length > 0) {
                html += '<h4>üìã Sample Orders:</h4>';
                html += '<table class="table table-striped">';
                html += '<thead><tr><th>OrderCode</th><th>Status</th><th>CreatedDate</th><th>UserId</th></tr></thead>';
                html += '<tbody>';
                data.sampleOrders.forEach(function(order) {
                    html += '<tr>';
                    html += '<td>' + order.OrderCode + '</td>';
                    html += '<td>' + order.Status + '</td>';
                    html += '<td>' + new Date(order.CreatedDate).toLocaleDateString() + '</td>';
                    html += '<td>' + order.UserId + '</td>';
                    html += '</tr>';
                });
                html += '</tbody></table>';
            }
            
            html += '<hr>';
            html += '<h3>üîç Full Response:</h3>';
            html += '<pre>' + JSON.stringify(response, null, 2) + '</pre>';
            
        } else {
            html += '<div class="alert alert-danger">Error: ' + response.message + '</div>';
            html += '<pre>' + response.stackTrace + '</pre>';
        }
        
        $('#testResults').html(html);
    }).fail(function(xhr, status, error) {
        console.error('Error:', error);
        $('#testResults').html('<div class="alert alert-danger">AJAX Error: ' + error + '<br>Response: ' + xhr.responseText + '</div>');
    });
    
    // Also test the original API
    setTimeout(function() {
        $.post('@Url.Action("GetLuxuryWatchSalesStats", "Dashboard")', function(response) {
            console.log('Sales Stats Response:', response);
            
            let html = $('#testResults').html();
            html += '<hr><h3>üìà Sales Stats API:</h3>';
            html += '<pre>' + JSON.stringify(response, null, 2) + '</pre>';
            $('#testResults').html(html);
        }).fail(function(xhr, status, error) {
            console.error('Sales Stats Error:', error);
            let html = $('#testResults').html();
            html += '<hr><div class="alert alert-warning">Sales Stats API Error: ' + error + '</div>';
            $('#testResults').html(html);
        });
    }, 1000);
    
    // T·∫°o d·ªØ li·ªáu m·∫´u
    $('#createSampleDataBtn').on('click', function() {
        $(this).prop('disabled', true).text('ƒêang t·∫°o...');
        
        $.post('@Url.Action("CreateSampleData", "Dashboard")', function(response) {
            if (response.success) {
                alert('Th√†nh c√¥ng: ' + response.message);
                $('#refreshDataBtn').click(); // T·ª± ƒë·ªông refresh
            } else {
                alert('L·ªói: ' + response.message);
            }
        }).fail(function() {
            alert('L·ªói khi t·∫°o d·ªØ li·ªáu m·∫´u');
        }).always(function() {
            $('#createSampleDataBtn').prop('disabled', false).html('<i class="fas fa-plus"></i> T·∫°o D·ªØ Li·ªáu M·∫´u');
        });
    });
    
    // L√†m m·ªõi d·ªØ li·ªáu
    $('#refreshDataBtn').on('click', function() {
        location.reload();
    });
});
</script>
