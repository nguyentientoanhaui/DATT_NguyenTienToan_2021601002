@{
    ViewData["Title"] = "C·∫•u h√¨nh Local AI Chatbot";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-desktop"></i> C·∫•u h√¨nh Local AI Chatbot
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon bg-primary">
                                    <i class="fas fa-cog"></i>
                                </span>
                                <div class="info-box-content">
                                    <span class="info-box-text">AI Provider hi·ªán t·∫°i</span>
                                    <span class="info-box-number">@ViewBag.CurrentProvider</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon @(ViewBag.OllamaConfigured ? "bg-success" : "bg-warning")">
                                    <i class="fas fa-server"></i>
                                </span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Ollama Local AI</span>
                                    <span class="info-box-number">@(ViewBag.OllamaConfigured ? "ƒê√£ c·∫•u h√¨nh" : "Ch∆∞a c·∫•u h√¨nh")</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="info-box">
                                <span class="info-box-icon bg-info">
                                    <i class="fas fa-heartbeat"></i>
                                </span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Tr·∫°ng th√°i Local AI</span>
                                    <span class="info-box-number" id="aiStatus">ƒêang ki·ªÉm tra...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Th√¥ng tin c·∫•u h√¨nh Local AI</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Ollama URL:</label>
                                                <input type="text" class="form-control" value="@ViewBag.OllamaUrl" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Model Name:</label>
                                                <input type="text" class="form-control" value="@ViewBag.OllamaModel" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Ki·ªÉm tra Local AI</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <button type="button" class="btn btn-primary btn-block" id="testAI">
                                                <i class="fas fa-play"></i> Test AI Response
                                            </button>
                                        </div>
                                        <div class="col-md-6">
                                            <button type="button" class="btn btn-success btn-block" id="checkHealth">
                                                <i class="fas fa-heartbeat"></i> Ki·ªÉm tra s·ª©c kh·ªèe
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3" id="testResult" style="display: none;">
                                        <div class="alert alert-info">
                                            <h5>K·∫øt qu·∫£ test:</h5>
                                            <div id="testResponse"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">H∆∞·ªõng d·∫´n Local AI</h4>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-success">
                                        <h5><i class="fas fa-check-circle"></i> Local AI ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh!</h5>
                                        <p>Chatbot c·ªßa b·∫°n ƒëang s·ª≠ d·ª•ng <strong>Local AI</strong> - ho√†n to√†n mi·ªÖn ph√≠ v√† kh√¥ng c·∫ßn internet!</p>
                                    </div>

                                    <div class="alert alert-info">
                                        <h5><i class="fas fa-info-circle"></i> C·∫•u h√¨nh Local AI</h5>
                                        <p>ƒê·ªÉ thay ƒë·ªïi gi·ªØa c√°c local AI providers, ch·ªânh s·ª≠a file <code>appsettings.json</code>:</p>
                                        <pre><code>{
  "AI": {
    "Provider": "ONNX" // C√°c t√πy ch·ªçn: ONNX, Ollama
  },
  "LocalAI": {
    "OllamaUrl": "http://localhost:11434",
    "ModelName": "llama3.2:3b"
  }
}</code></pre>
                                    </div>

                                    <div class="alert alert-warning">
                                        <h5><i class="fas fa-exclamation-triangle"></i> C√†i ƒë·∫∑t Ollama (T√πy ch·ªçn)</h5>
                                        <p>N·∫øu mu·ªën s·ª≠ d·ª•ng Ollama v·ªõi ch·∫•t l∆∞·ª£ng cao h∆°n:</p>
                                        <ol>
                                            <li>C√†i ƒë·∫∑t Ollama: <code>winget install Ollama.Ollama</code></li>
                                            <li>T·∫£i model: <code>ollama pull llama3.2:3b</code></li>
                                            <li>Ch·∫°y Ollama: <code>ollama serve</code></li>
                                            <li>ƒê·ªïi provider th√†nh "Ollama" trong appsettings.json</li>
                                        </ol>
                                    </div>

                                    <div class="alert alert-primary">
                                        <h5><i class="fas fa-lightbulb"></i> L·ª£i √≠ch c·ªßa Local AI</h5>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>üöÄ T·ªëc ƒë·ªô:</h6>
                                                <ul>
                                                    <li>50-100ms response time</li>
                                                    <li>Kh√¥ng ph·ª• thu·ªôc internet</li>
                                                    <li>X·ª≠ l√Ω song song</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>üîí B·∫£o m·∫≠t:</h6>
                                                <ul>
                                                    <li>D·ªØ li·ªáu kh√¥ng r·ªùi kh·ªèi m√°y</li>
                                                    <li>Kh√¥ng c·∫ßn API key</li>
                                                    <li>Ki·ªÉm so√°t ho√†n to√†n</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Ki·ªÉm tra s·ª©c kh·ªèe AI khi load trang
            checkAIHealth();

            $('#testAI').click(function() {
                testAI();
            });

            $('#checkHealth').click(function() {
                checkAIHealth();
            });
        });

        function testAI() {
            $('#testAI').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> ƒêang test...');
            
            $.post('@Url.Action("TestAI")', function(data) {
                if (data.success) {
                    $('#testResponse').html('<strong>Provider:</strong> ' + data.provider + '<br><strong>Response:</strong> ' + data.response);
                    $('#testResult').show();
                } else {
                    $('#testResponse').html('<strong>L·ªói:</strong> ' + data.error);
                    $('#testResult').show();
                }
            }).fail(function() {
                $('#testResponse').html('<strong>L·ªói:</strong> Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server');
                $('#testResult').show();
            }).always(function() {
                $('#testAI').prop('disabled', false).html('<i class="fas fa-play"></i> Test AI Response');
            });
        }

        function checkAIHealth() {
            $('#checkHealth').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> ƒêang ki·ªÉm tra...');
            
            $.post('@Url.Action("CheckHealth")', function(data) {
                if (data.success) {
                    if (data.healthy) {
                        $('#aiStatus').html('<span class="badge badge-success">Local AI ho·∫°t ƒë·ªông t·ªët</span>');
                    } else {
                        $('#aiStatus').html('<span class="badge badge-warning">Local AI c√≥ v·∫•n ƒë·ªÅ</span>');
                    }
                } else {
                    $('#aiStatus').html('<span class="badge badge-danger">L·ªói: ' + data.error + '</span>');
                }
            }).fail(function() {
                $('#aiStatus').html('<span class="badge badge-danger">Kh√¥ng th·ªÉ k·∫øt n·ªëi</span>');
            }).always(function() {
                $('#checkHealth').prop('disabled', false).html('<i class="fas fa-heartbeat"></i> Ki·ªÉm tra s·ª©c kh·ªèe');
            });
        }
    </script>
}